---
import { HolidazeGateWay } from "../gateway/HolidazeGateway";
import BookingCard from "../components/uiComponents/bookings/bookingCard.svelte";
import Layout from "../layouts/Layout.astro";
import type { Booking } from "../types/types";

const { user, token } = Astro.locals;

if (!user) return Astro.redirect("/login");

const holidazeGateWay = new HolidazeGateWay();
let data: Booking[];
try {
  const fetchedData = await holidazeGateWay.profile(
    user,
    token,
    import.meta.env.API_KEY
  );
  data = fetchedData?.data?.bookings;
} catch (error) {
  console.error("Failed to fetch data:", error);
  data = [];
}
---

<Layout title="bookings">
  <section>
    {
      data.length > 0 ? (
        <>
          <h1>Bookings & Trips</h1>
          <BookingCard data={data} client:load />
        </>
      ) : (
        <h1>No bookings yet</h1>
      )
    }
  </section>
</Layout>

<style lang="scss">
  section {
    max-width: 1000px;
    width: 100%;
    margin: 20px auto;
    padding: 16px;
    h1 {
      font-size: 100px;
      text-align: center;
      @media (max-width: 1100px) {
        font-size: 40px;
      }
    }
  }
</style>
